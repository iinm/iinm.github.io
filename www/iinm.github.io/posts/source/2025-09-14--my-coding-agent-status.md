# 私とコーディングエージェントの現在地

2025年はCline/Devinブームから始まり、Claude Code、Gemini CLI、Codex CLIなどの様々なコーディングエージェントが登場、加えてモデル自体の進化も進み、Webアプリケーション開発の現場では使うのが当たり前になるくらい実用的なレベルになりました。

特に直近半年は私自身もコーディングエージェントを作り、実践の中で試行錯誤を繰り返しながら活用方法や安全性などの考慮すべき点を模索してきました。
結果、最近の案件ではコミットしたコードのうち約60%がエージェントを利用したものとなっており、ようやく活用できるようになったと実感し始めています。

このようなタイミングで、さらにこの先の理想状態を想像するためにも現状を整理しようと思います。

## Background

コーディングエージェントの活用のしやすさは、関わるプロジェクトの性質や役割にも影響を受けると思うので、まずは前提を書き残しておきます。

- **関わっているプロダクト**: 海外ツアーやホテルの予約サイトで、システムの要素としては旅行者が旅行商品を予約するアプリ（ネイティブ、Web）、旅行商品管理（商品の入稿や値付け）や顧客・予約管理（手配業務など）をするための旅行管理システムの2つがあります。
- **私の担当領域・ドメイン特性**: 主に旅行商品や顧客・予約管理のための旅行管理システムを担当。例えば、商品バリエーションの拡充やフライトやホテルの手配を自動化するために、複数のサププライヤーと在庫料金や予約情報をやり取りする仕組みを構築、拡張しています。サププライヤーごとに機能やキャンセルポリシー、お作法などの違いがあり、それらを自社商品であるパッケージツアーとして統合するのが難しいポイントです。
- **技術特性**:
  - 言語はBackend/FrontendともにTypeScript、API InterfaceはGraphQL、旅行管理システムのUIはNext.js+コンポーネントライブラリ（自分でコンポーネントを書くことはほぼない）
  - 在庫料金情報を定期的にリフレッシュしたり、イベントトリガーで手配処理を実行したり、Backendでやることが多くコードベースはBackendの方が大きい。
- **システム規模（参考値）**
  - 開発期間は約3年、初期は2，3人でスタート、現在は10名ほどのエンジニアが関わっています
  - APIのTypeScriptのソースファイルが数千件、合計数十万行
  - メインで利用しているリレーショナルデータベースのテーブル数は数百

## 現時点での私の活用レベル

### できていること

- 🔍️ **既存実装の調査**: コーディングエージェントを触り初めた当初、最も活用したのが既存のコード構成の調査です。
  数年掛けて作り上げたシステムは自分が担当した機能に関しても記憶が薄れていきますし、開発メンバー/開発の並列度が増えて自分が知らない部分も増えてきました。
  当然そのような状況では、これから改修する部分とその影響範囲の現状把握に多くの時間を取られることになります。
  例えばですが「xxx.tsの関数xxxはどのエンドポイントから呼ばれている？呼び出し階層や呼び出される条件をツリー形式でまとめて欲しい」（呼び出し階層が深く分岐も多くてコードを追うのが大変な部分）、
  「予約関連のエンドポイントがどのような順序・依存関係で呼ばれるかをGraphQLのschemaをヒントに調査して欲しい」（複数エンドポイントにまたがるフロー、なにかしらパラメーターをリレーすることをヒントに依存関係を追わせる）というように、愚直にコードを読んで依存関係を調査・レポートしてもらう、という使い方です。
- 💬 **命名の壁打ち**: 必要なエンドポイントやQueueの役割を私の方でまとめたうえで、その命名の候補をあげてもらう、という使い方です。
  悔しいことに私よりも英語の言葉選びが上手なので簡潔でわかりやすい名前を考えてくれます。
  ソフトウェアを一定期間運用していると、作った当初には想定しなかったユースケースが増えたり、ドメインへの理解が深まることで当初の命名が適切でなかったことに気づき後悔することが多々あります。※ エージェントが書いたコードはまだ運用期間が短いのでその良し悪しはまだ分からないこともあります。
  気軽に相談できる命名の壁打ち相手ができたことで、こういった誤りも減らせると良いですね。
- 🔄 **数百行程度のInput/Outputが明確な関数の実装とテスト**: 関数のInput/Outputの型定義を私の方で書き、関数の役割や考慮ポイントを説明したうえで、実装と自動テストを書いてもらう、という使い方です。
  完成度100%とはいかず不要なエラーハンドリングや可読性の悪さは残りますが、大枠は外しません。
  必要な関数やクラスは私の方で整理して、関数レベルでまずは動くものを書いてもらう → テストケースを確認して、境界値など考慮できてないポイントがあればテストケースを追加してもらう/内容の重複した無駄なテストは消す → 最終的に私の方でレビューしながら無駄な分岐やネスト、意味の薄いコメントを削除して可読性を改善する、という流れで完成させます。
- 🧹 **リファクタリング**: 多くの呼び出し箇所から参照されている関数のInterface変更や同じような計算処理の共通化など、機械的な書き換えと自動テストで結果を検証できるものは任せることができます。
- 🚀 **実装の並列化**: コーディングエージェントを利用した開発において、私がやることはコード構成（関数やクラス）の整理までになり、そこから先はコーディングエージェントが「大枠を外さない」粒度で実装を委託、フィードバックを通してテストケースの補強やリファクタを繰り返して完成度を高める、という流れになります。
  エージェントが実装している間は私の手が空くので、その間に別ブランチで依存しない別の関数や別案件の開発を進めることができます。
  ただし、アウトプットの最終調整が必要なので、それ以上に同時に動かしても自分がボトルネックになります。
  また、よくある話だと思いますが、どんなに考えて設計しても実装を通して理解が深まることで設計の問題が顕在化し、設計を見直さなければならないことがあります。（最悪のケースでは仕様レベルでの検討が必要になることもある）
  そう考えると、今見えている仕様と設計が100%正しいと仮定してエージェントに委託できる粒度に分解できたとしても、それを高い並列度で実装するのはあまり現実感がありません。
  割り切って進めることもできなくはないと思いますが、長期的な安定性や拡張性を見据えた再設計のチャンスを潰すことになると考えてます。
- 📺 **既製コンポーネントを組み合わせたUIの実装**: コンポーネントライブラリを組み合わせで作っているような画面は、使って欲しいコンポーネントと似たような画面の実装を渡すことでうまく実装してくれます。
  Devinの場合はスクリーンショットを取りながらブラウザ操作で動作確認まで実施してもらいます。
  ※ ただし、様々な要素を含むツアーパッケージとその予約はテストデータのセットアップが大変で、Devinにはお任せできていません。

### できてないこと/試せてないこと

- **大局的な視点が必要な設計（複数のAPIエンドポイントをまたぐようなフローと各エンドポイントのInterfaceなど）**: これは試せてません。というのも、仕様や制約事項を整理して理解する過程で自然と見えてくるので、エージェントにお願いしたことがないという状態です。ただし、これは私が今のシステムの開発初期から関わっていて、利用している技術スタックに関しての適用パターンや運用のナレッジを持っているからだと考えています。
  今の技術スタックだけでは解決できないような課題や、今後自分が詳しくない環境で開発をする際にはぜひ活用したいです。
- **内部のコンポーネント構成の設計（関数やクラス）**: これは私のプロンプト力、想像力の問題かもしれません。
  現在のコーディングエージェントの能力では、自動テストで検証可能な数百行サイズのコンポーネントに分割すれば「大枠を外さない」ことは感覚的に分かっています。
  コンポーネント分割の際には、人にとっての認知のしやすさ（抽象度の一貫性など）や再利用性、Interfaceの普遍性（後で実装だけ最適化できるなど）を大事にしていますが、
  （今始めて言語化したかもしれない）これがうまく伝えられず無駄に複雑なInterfaceを生成するようなことが何度か発生しました。
  現時点では、自分でざっくりとInterfaceだけ書いてみて納得感を持てたらあとは実装を委託する、というやり方がうまく機能してます。
- **運用作業**: エラーログの調査や機能に対する問い合わせなど、まだまだエージェントにお任せできそうな仕事が多数あります。これからの取り組むべき重要な課題の一つです。
  アプリケーションログやデータベース、ソースコードへのアクセス権限を安全に渡せるか、各種情報を効果的に渡せるかが重要なポイントになると考えています。

## 自作ツールに関して

## Tips

### プロンプト

### 並列実行


## 今後どこに向かっていくのか？
